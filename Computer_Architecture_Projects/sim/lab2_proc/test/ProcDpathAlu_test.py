#=========================================================================
# ProcDpathAlu unit tests
#=========================================================================

from pymtl3 import *
from pymtl3.stdlib.test_utils import run_test_vector_sim

from lab2_proc.ProcDpathAlu import ProcDpathAlu

#-------------------------------------------------------------------------
# add
#-------------------------------------------------------------------------

def test_alu_add( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,   0,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x0ffaa660,   0x00012304,   0,  0x0ffbc964,   '?',      '?',       '?'      ],
    # pos-neg
    [ 0x00132050,   0xd6620040,   0,  0xd6752090,   '?',      '?',       '?'      ],
    [ 0xfff0a440,   0x00004450,   0,  0xfff0e890,   '?',      '?',       '?'      ],
    # neg-neg
    [ 0xfeeeeaa3,   0xf4650000,   0,  0xf353eaa3,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# sub
#-------------------------------------------------------------------------

def test_alu_sub( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,   1,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x0ffaa660,   0x00012304,   1,  0x0ff9835c,   '?',      '?',       '?'      ],
    # pos-neg
    [ 0x00132050,   0xd6620040,   1,  0x29b12010,   '?',      '?',       '?'      ],
    [ 0xfff0a440,   0x00004450,   1,  0xfff05ff0,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# and
#-------------------------------------------------------------------------

def test_alu_and( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,   2,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x10101010,   0x01010101,   2,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x10001000,   0x10001000,   2,  0x10001000,   '?',      '?',       '?'      ],
    [ 0xffff0000,   0xaaaa0000,   2,  0xaaaa0000,   '?',      '?',       '?'      ],
    [ 0x00003543,   0x00006737,   2,  0x00002503,   '?',      '?',       '?'      ],
  ], cmdline_opts )


#-------------------------------------------------------------------------
# or
#-------------------------------------------------------------------------

def test_alu_or( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,   3,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x10101010,   0x01010101,   3,  0x11111111,   '?',      '?',       '?'      ],
    [ 0x10001000,   0x10001000,   3,  0x10001000,   '?',      '?',       '?'      ],
    [ 0xffff0000,   0xaaaa0000,   3,  0xffff0000,   '?',      '?',       '?'      ],
    [ 0x00003543,   0x00006737,   3,  0x00007777,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# xor
#-------------------------------------------------------------------------

def test_alu_xor( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,   4,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x10101010,   0x01010101,   4,  0x11111111,   '?',      '?',       '?'      ],
    [ 0x10011001,   0x10001000,   4,  0x00010001,   '?',      '?',       '?'      ],
    [ 0xffff0000,   0xaaaa0000,   4,  0x55550000,   '?',      '?',       '?'      ],
    [ 0x00003543,   0x00006737,   4,  0x00005274,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# slt
#-------------------------------------------------------------------------

def test_alu_slt( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0xf0000000,   0x00000001,   5,  0x00000001,   '?',      '?',       '?'      ],
    [ 0xf0101010,   0x01010101,   5,  0x00000001,   '?',      '?',       '?'      ],
    [ 0x10011001,   0x10001000,   5,  0x00000000,   '?',      '?',       '?'      ],
    [ 0xffff0000,   0xaaaa0000,   5,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x00003543,   0x00006737,   5,  0x00000001,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# sltu
#-------------------------------------------------------------------------

def test_alu_sltu( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0xf0000000,   0x00000001,   6,  0x00000000,   '?',      '?',       '?'      ],
    [ 0xf0101010,   0x01010101,   6,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x10011001,   0x10001000,   6,  0x00000000,   '?',      '?',       '?'      ],
    [ 0xffff0000,   0xaaaa0000,   6,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x00003543,   0x00006737,   6,  0x00000001,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# sra
#-------------------------------------------------------------------------

def test_alu_sra( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0xffffffff,   0x00000001,   7,  0xffffffff,   '?',      '?',       '?'      ],
    [ 0xf0101010,   0x01010101,   7,  0xf8080808,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# srl
#-------------------------------------------------------------------------

def test_alu_srl( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0xf0000000,   0x00000001,   8,  0x78000000,   '?',      '?',       '?'      ],
    [ 0xf0101010,   0x01010101,   8,  0x78080808,   '?',      '?',       '?'      ],
    [ 0x10011001,   0x10001000,   8,  0x10011001,   '?',      '?',       '?'      ],
    [ 0xffff0000,   0xaaaa0000,   8,  0xffff0000,   '?',      '?',       '?'      ],
    [ 0x00003543,   0x00006737,   8,  0x00000000,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# sll
#-------------------------------------------------------------------------

def test_alu_sll( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x10000000,   0x00000001,   9,  0x20000000,   '?',      '?',       '?'      ],
    [ 0x0fffffff,   0x00000004,   9,  0xfffffff0,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# cp_op0
#-------------------------------------------------------------------------

def test_alu_cp_op0( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,  11,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x0ffaa660,   0x00012304,  11,  0x0ffaa660,   '?',      '?',       '?'      ],
    [ 0x00132050,   0xd6620040,  11,  0x00132050,   '?',      '?',       '?'      ],
    [ 0xfff0a440,   0x00004450,  11,  0xfff0a440,   '?',      '?',       '?'      ],
    [ 0xfeeeeaa3,   0xf4650000,  11,  0xfeeeeaa3,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# cp_op1
#-------------------------------------------------------------------------

def test_alu_cp_op1( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,  12,  0x00000000,   '?',      '?',       '?'      ],
    [ 0x0ffaa660,   0x00012304,  12,  0x00012304,   '?',      '?',       '?'      ],
    [ 0x00132050,   0xd6620040,  12,  0xd6620040,   '?',      '?',       '?'      ],
    [ 0xfff0a440,   0x00004450,  12,  0x00004450,   '?',      '?',       '?'      ],
    [ 0xfeeeeaa3,   0xf4650000,  12,  0xf4650000,   '?',      '?',       '?'      ],
  ], cmdline_opts )

#-------------------------------------------------------------------------
# cp_equality
#-------------------------------------------------------------------------

def test_alu_fn_equality( cmdline_opts ):
  dut = ProcDpathAlu()

  run_test_vector_sim( dut, [
    ('in0           in1           fn  out*          ops_eq*   ops_lt*  ops_ltu*'),
    [ 0x00000000,   0x00000000,  14,  0x00000000,   1,        '?',       '?'      ],
    [ 0x0ffaa660,   0x00012304,  14,  0x00000000,   0,        '?',       '?'      ],
    [ 0x00132050,   0xd6620040,  14,  0x00000000,   0,        '?',       '?'      ],
    [ 0xfff0a440,   0x00004450,  14,  0x00000000,   0,        '?',       '?'      ],
    [ 0xfeeeeaa3,   0xf4650000,  14,  0x00000000,   0,        '?',       '?'      ],
  ], cmdline_opts )

